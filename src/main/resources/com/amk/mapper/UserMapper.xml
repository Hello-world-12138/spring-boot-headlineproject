<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.amk.mapper.UserMapper">

    <resultMap id="BaseResultMap" type="com.amk.pojo.User">
            <id property="uid" column="uid" />
            <result property="username" column="username" />
            <result property="userPwd" column="user_pwd" />
            <result property="nickName" column="nick_name" />
            <result property="role" column="role" />
            <result property="version" column="version" />
            <result property="isDeleted" column="is_deleted" />
    </resultMap>

    <sql id="Base_Column_List">
        uid,username,user_pwd,nick_name,role,version,is_deleted
    </sql>

    <!-- 管理端分页查询用户列表 -->
    <select id="selectAdminUserPage" resultType="map">
        select
            uid,
            username,
            nick_name   as nickName,
            CAST(role AS SIGNED) AS role,
            create_time as createTime
        from news_user
        where (is_deleted = 0 or is_deleted is null)
        order by uid desc
    </select>


    <select id="countTodayUsers" resultType="long">
        select count(*)
        from news_user
        where (is_deleted = 0 or is_deleted is null)
    </select>

    <select id="countUsersWithinDays" resultType="long">
        select count(*)
        from news_user
        where (is_deleted = 0 or is_deleted is null)
          and create_time >= DATE_SUB(CURDATE(), INTERVAL #{days} DAY)
    </select>

    <select id="selectUserTrend" resultType="map">
        select
            DATE(create_time) as dt,
            count(*) as cnt
        from news_user
        where (is_deleted = 0 or is_deleted is null)
          and create_time >= DATE_SUB(CURDATE(), INTERVAL #{days} DAY)
        group by DATE(create_time)
        order by dt
    </select>
</mapper>
