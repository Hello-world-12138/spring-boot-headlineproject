<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.amk.mapper.BannerMapper">

    <resultMap id="BaseResultMap" type="com.amk.pojo.Banner">
        <id property="id" column="id"/>
        <result property="title" column="title"/>
        <result property="subtitle" column="subtitle"/>
        <result property="imageUrl" column="image_url"/>
        <result property="linkUrl" column="link_url"/>
        <result property="sort" column="sort"/>
        <result property="status" column="status"/>
        <result property="category" column="category"/>
        <result property="startTime" column="start_time"/>
        <result property="endTime" column="end_time"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <sql id="Base_Column_List">
        id,title,subtitle,image_url,link_url,sort,status,category,
        start_time,end_time,create_time,update_time
    </sql>

    <!-- 前台轮播列表：只返回已上线且时间有效的记录，分类统一使用默认配置 -->
    <select id="selectFrontList" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from banner
        where status = 1
        and (start_time is null or start_time &lt;= now())
        and (end_time is null or end_time &gt;= now())
        order by sort desc, create_time desc
    </select>

    <!-- 管理端分页查询轮播列表 -->
    <select id="selectAdminPage" resultType="map">
        select
            id,
            title,
            subtitle,
            image_url  as imageUrl,
            link_url   as linkUrl,
            sort,
            status,
            category,
            start_time as startTime,
            end_time   as endTime,
            create_time as createTime,
            update_time as updateTime
        from banner
        <where>
            <if test="category != null and category != ''">
                category = #{category}
            </if>
        </where>
        order by sort desc, create_time desc
    </select>

</mapper>
